  <html>
    <head>
      <meta charset="utf-8">
      <title>Zicmobase Extension, Version 0.1.1</title>
      <style>
        #wrapper {width: 960px; margin: 0 auto;}
        /* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

      </style>
      <link href='https://fonts.googleapis.com/css?family=Noto+Serif' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/asciidoc.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/yaml.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/dockerfile.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/makefile.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/go.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/rust.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/haskell.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/typescript.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/scss.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/less.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/handlebars.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/groovy.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/scala.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/bash.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/ini.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script>
    </head>
    <body>
      <div id="wrapper">
        <div class="article">
          <h1 id="__asciidoctor-preview-0__">Zicmobase Extension, Version 0.1.1</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_goals">1.1. Goals</a></li>
<li><a href="#_non_goals">1.2. Non-Goals</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_memory_and_caches_in_risc_v">2.1. Memory and Caches in RISC-V</a></li>
<li><a href="#_system_topology">2.2. System Topology</a></li>
<li><a href="#_fixme_memory_ordering">2.3. FIXME: Memory Ordering</a></li>
<li><a href="#_fixme_discovery">2.4. FIXME: Discovery</a></li>
<li><a href="#_traps">2.5. Traps</a></li>
</ul>
</li>
<li><a href="#_formats">3. Formats</a>
<ul class="sectlevel2">
<li><a href="#_csrs">3.1. CSRs</a></li>
</ul>
</li>
<li><a href="#_instructions">4. Instructions</a>
<ul class="sectlevel2">
<li><a href="#_cache_block_management_instructions">4.1. Cache Block Management Instructions</a></li>
<li><a href="#_cache_block_write_instruction">4.2. Cache Block Write Instruction</a></li>
<li><a href="#_cache_block_hint_instructions">4.3. Cache Block Hint Instructions</a></li>
<li><a href="#_fixme_cache_block_discovery_instruction">4.4. FIXME: Cache Block Discovery Instruction</a></li>
</ul>
</li>
<li><a href="#_opcode_map">5. Opcode Map</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div id="__asciidoctor-preview-1__" class="paragraph">
<p>The Zicmobase extension adds a base set of <em>cache management operation</em> (or
<em>CMO</em>) instructions and CSRs to the RISC-V architecture.
The base extension includes several classes of instructions that operate on
cache blocks:</p>
</div>
<div id="__asciidoctor-preview-2__" class="ulist">
<ul>
<li id="__asciidoctor-preview-3__">
<p>A set of cache block management instructions, i.e. <code>CBO.INVAL</code>, <code>CBO.CLEAN</code>,
and <code>CBO.FLUSH</code></p>
</li>
<li id="__asciidoctor-preview-4__">
<p>A cache block write instruction, i.e. <code>CBO.ZERO</code></p>
</li>
<li id="__asciidoctor-preview-5__">
<p>A set of cache block hint instructions, i.e. <code>PREFETCH.R</code>, <code>PREFETCH.W</code>,
<code>PREFETCH.I</code>, and <code>DEMOTE</code></p>
</li>
<li id="__asciidoctor-preview-6__">
<p>A cache block size discovery instruction, i.e. <code>CBO.SIZE</code> (TBD)</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-7__" class="paragraph">
<p>The execution of these instructions in various privilege modes is controlled by
a set of CSRs.
In addition, this specification introduces architectural abstractions for
caches and system topologies to support portable software across various system
designs.</p>
</div>
<div class="sect2">
<h3 id="_goals">1.1. Goals</h3>
<div id="__asciidoctor-preview-8__" class="ulist">
<ul>
<li id="__asciidoctor-preview-9__">
<p>Define instructions that operate on an architectural abstraction of caches
and system topology</p>
</li>
<li id="__asciidoctor-preview-10__">
<p>Specify the interactions of CMOs with the RVWMO memory ordering model</p>
</li>
<li id="__asciidoctor-preview-11__">
<p>Support various software use-cases such as software-managed cache coherence
and non-coherent I/O</p>
</li>
<li id="__asciidoctor-preview-12__">
<p>Allow execution of CMOs in lower privilege modes, including U-mode</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_non_goals">1.2. Non-Goals</h3>
<div id="__asciidoctor-preview-13__" class="paragraph">
<p>The following goals are intentionally deferred to a later specification:</p>
</div>
<div id="__asciidoctor-preview-14__" class="ulist">
<ul>
<li id="__asciidoctor-preview-15__">
<p>Cache management operations on microarchitectural characteristics, e.g.
set/way operations or whole cache operations</p>
</li>
<li id="__asciidoctor-preview-16__">
<p>Specifying the behavior of cache management operations on different cache
block sizes</p>
</li>
<li id="__asciidoctor-preview-17__">
<p>Performance has <em>not</em> been a primary goal for this version of the
specification (though the specification is mindful not to hinder performance)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">2. Overview</h2>
<div class="sectionbody">
<div id="__asciidoctor-preview-18__" class="paragraph">
<p>In general, a CMO instruction initiates an operation on a set of caches based
on instruction type, CSR state, physical memory attributes, and other
architectural state.
A CMO instruction specifies an effective address, which may be translated by
various translation mechanisms into a physical address.
A hart may then perform a subsequent memory access with that physical address
in order to operate on various caches throughout a system.</p>
</div>
<div class="sect2">
<h3 id="_memory_and_caches_in_risc_v">2.1. Memory and Caches in RISC-V</h3>
<div id="__asciidoctor-preview-19__" class="paragraph">
<p>As specified in the RISC-V base and privileged architectures, memory is
organized as an array of bytes, with a given physical address identifying a
particular memory location.
Each memory location is further associated with a main memory region, an I/O
device region, or a vacant region.
In this extension, a <em>memory agent</em> services memory accesses to a set of memory
locations that comprise a memory region (of any type), while a <em>system agent</em>
performs memory accesses to memory locations and may be a hart or an I/O device
(or <em>device</em> for short).</p>
</div>
<div id="__asciidoctor-preview-20__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-21__" class="paragraph">
<p><em>A particular I/O device may be a memory agent, a system agent, or both.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-22__" class="paragraph">
<p>Caches in RISC-V reduce average memory latency by buffering copies of data from
frequently accessed memory locations close to system agents.
Specifically, a cache buffers copies of <em>cache blocks</em>, each of which consists
of a contiguous, non-overlapping, naturally aligned power-of-two (NAPOT) set of
bytes and corresponds to a similarly NAPOT set of memory locations and
associated physical addresses.
A system may make multiple copies of a given cache block, and these copies may
be transferred to and from various caches and memory.
The underlying memory locations for a cache block form the <em>backing storage</em>
for the block, and the organization of a cache and the size of a cache block
are <em>implementation-defined</em>.</p>
</div>
<div id="__asciidoctor-preview-23__" class="paragraph">
<p>RISC-V defines three types of caches: A <em>private cache</em> is accessed by a single
system agent, while a <em>shared cache</em> is accessed by more than one system agent.
In addition, a <em>memory cache</em> is localized to memory agent and is effectively
"invisible" to the system agents that access a given memory location.
(In other words, a memory cache may serve as a proxy for the actual physical
memory location.)
The base set of cache management operations operates on private and shared
caches only and is <em>not</em> guaranteed to operate on memory caches.</p>
</div>
<div id="__asciidoctor-preview-24__" class="paragraph">
<p><strong><em>FIXME:</em></strong> types of cache blocks?</p>
</div>
<div class="sect3">
<h4 id="_cache_block_states">2.1.1. Cache Block States</h4>
<div id="__asciidoctor-preview-25__" class="paragraph">
<p>Relative to a given cache, a cache block may be in one of three states:</p>
</div>
<div id="__asciidoctor-preview-26__" class="ulist">
<ul>
<li id="__asciidoctor-preview-27__">
<p><em>Invalid</em>&#8201;&#8212;&#8201;the cache block is <em>not</em> present in the cache</p>
</li>
<li id="__asciidoctor-preview-28__">
<p><em>Unmodified</em>&#8201;&#8212;&#8201;the cache block is present in the cache and <em>this</em> copy has
<em>not</em> been written by a system agent</p>
</li>
<li id="__asciidoctor-preview-29__">
<p><em>Modified</em>&#8201;&#8212;&#8201;the cache block is present in the cache and <em>this</em> copy has been
written by a system agent</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-30__" class="paragraph">
<p>All caches differentiate between invalid and unmodified cache blocks, and a
cache may or may not track modified cache blocks depending on
<em>implementation-defined</em> write policies, e.g. write-back or write-through,
respectively.
A cache, therefore, may implement only two states (invalid and unmodified) or
all three states (invalid, unmodified, and modified).
Additionally, a cache block in either the unmodified or modified state is
considered to be <em>valid</em>.</p>
</div>
<div id="__asciidoctor-preview-31__" class="paragraph">
<p>In addition, based on <em>implementation-defined</em> system-wide cache policies and
mechanisms, an unmodified cache block may <em>not</em> be consistent with memory, and
a modified copy may be present in another cache at the same time.
Furthermore, the state of the cache block may also be communicated when the
block is transferred to or from the cache.
These policies and mechanisms are typically defined by a cache coherence
protocol (see the <a href="#_system_topology">System Topology</a> section) and are beyond the scope of
this specification.</p>
</div>
<div id="__asciidoctor-preview-32__" class="paragraph">
<p>A transition from invalid to valid occurs when a cache allocates a cache block,
resulting in a transfer of the block to the cache from another cache or memory
(performing a <em>memory read</em> in the latter case).
To the extent allowed by the base and privileged architectures, a cache may
allocate a cache block for any physical address at any time for any reason.
The cache block is allocated in either the unmodified or modified state
depending on whether the cache tracks modified cache blocks and whether an
unmodified or modified cache block is transferred to the cache.</p>
</div>
<div id="__asciidoctor-preview-33__" class="paragraph">
<p>A transition from valid to invalid occurs when a cache deallocates the cache
block, potentially resulting in a transfer of the block from the cache to
another cache or memory (performing a <em>memory write</em> in the latter case).
A cache may deallocate a cache block at any time for any reason.
If the cache block is unmodified, the cache may transfer the cache block to
another cache but <em>must not</em> transfer the cache block to memory to avoid
overwriting memory with potentially stale data.
(The behavior of CMO instructions becomes UNSPECIFIED if a cache transfers an
unmodified cache block to memory.)
If the cache block is modified, the cache <em>must</em> transfer the modified block to
another cache or memory.</p>
</div>
<div id="__asciidoctor-preview-34__" class="paragraph">
<p>Finally, if the cache tracks modified cache blocks, a transition from
unmodified to modified occurs whenever a system agent executes an instruction,
e.g. a store instruction, or performs an operation, e.g. a page table entry
write, that writes to a cache block that has been transferred to the cache.
To cause the transition, the instruction or operation only needs to be
classified as a data write that <em>may</em> change the data values in the cache
block; the data write is <em>not</em> required to change the data values.
If the cache does <em>not</em> track modified cache blocks, the data write <em>must</em> be
propagated either to another cache that does track modified cache blocks or to
memory.
In such a cache, the data write <em>must</em> update the data values of the cache
block, or the cache block <em>must</em> transition to invalid.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cmo_effects_on_caches">2.1.2. CMO Effects on Caches</h4>
<div id="__asciidoctor-preview-35__" class="paragraph">
<p>CMO instructions may also affect the state of a cache block.
A cache block management instruction performs one of the following operations,
which may change the state of a cache block and may result in a transfer of
data from the cache:</p>
</div>
<div id="__asciidoctor-preview-36__" class="ulist">
<ul>
<li id="__asciidoctor-preview-37__">
<p>An <em>invalidate</em> operation <em>must</em> change the state of a valid cache block
to invalid; otherwise, no state change occurs.
The operation may transfer the cache block if its state was valid before the
operation; however, the transfer of the cache block is <em>not</em> required.</p>
</li>
<li id="__asciidoctor-preview-38__">
<p>A <em>clean</em> operation <em>must</em> change the state of a modified cache block to
unmodified, although the operation may change the state of a valid cache
block to invalid; otherwise, no state change occurs.
The operation <em>must</em> transfer the cache block if its state was modified
before the operation and may transfer the cache block if its state was
unmodified before the operation.</p>
</li>
<li id="__asciidoctor-preview-39__">
<p>A <em>flush</em> operation <em>must</em> change the state of a valid cache block to
invalid; otherwise, no state change occurs.
The operation <em>must</em> transfer the cache block if its state was modified
before the operation and may transfer the cache block if its state was
unmodified before the operation.</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-40__" class="paragraph">
<p>A cache block write instruction effectively performs a series of byte atomic
data write operations, similar to a series of store byte instructions.
An implementation may or may not update the entire cache block atomically.</p>
</div>
<div id="__asciidoctor-preview-41__" class="paragraph">
<p>Finally, a cache block hint instruction may perform an <em>implementation-defined</em>
operation or no operation, the latter of which does not affect the state of the
cache.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_topology">2.2. System Topology</h3>
<div id="__asciidoctor-preview-42__" class="paragraph">
<p>A memory access from a CMO instruction proceeds along <em>memory access path</em> (or
<em>path</em> for short) from a given system agent toward a given memory location.
A path is determined primarily by the following characteristics:</p>
</div>
<div id="__asciidoctor-preview-43__" class="ulist">
<ul>
<li id="__asciidoctor-preview-44__">
<p>The physical address of the memory access</p>
</li>
<li id="__asciidoctor-preview-45__">
<p>The memory attributes associated with the memory access</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-46__" class="paragraph">
<p>The physical address identifies the memory location being accessed and is a
function of the effective address specified by a CMO instruction and any
enabled translation mechanisms.
In addition, the memory attributes for a memory access may be specified by
either architectural or <em>implementation-defined</em> mechanisms.
Other factors, such as type of operation, may also influence the path.</p>
</div>
<div id="__asciidoctor-preview-47__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-48__" class="paragraph">
<p><em>The memory attributes that typically affect a path are related to cacheability</em>
<em>and coherence; however, other memory attributes may affect a path.</em></p>
</div>
<div id="__asciidoctor-preview-49__" class="paragraph">
<p><em>From the same system agent, paths for memory accesses with the same memory</em>
<em>attributes to different memory locations may be different.</em>
<em>Likewise, paths for memory accesses with different memory attributes to the</em>
<em>same memory location may be different.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-50__" class="paragraph">
<p>Paths from different system agents to the same memory location converge at a
<em>point of convergence</em> (or <em>PoC</em>), and from a given PoC, the paths that have
converged do not diverge.
In addition, the memory accesses on those paths are ordered, and remain
ordered, with respect to each other from a PoC until the memory accesses can be
completed.
A PoC is <em>not</em> required to order memory accesses to different memory locations.
Once an order has been established, those memory accesses are considered to be
<em>access ordered</em> and cannot be reordered within the system.</p>
</div>
<div id="__asciidoctor-preview-51__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-52__" class="paragraph">
<p><em>This ordering definition is necessary to implement cache coherence protocols</em>
<em>and forms the basis for the memory ordering model below.</em>
<em>Effectively, a PoC establishes a coherence order for a given memory location</em>
<em>with respect to a given set of agents.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-53__" class="paragraph">
<p>For every memory location in a system, the <em>point of convergence of memory</em>, or
<em>PoC-memory</em>, is the PoC where all paths for a given memory location converge,
independent of all other characteristics that define a path.
At the PoC-memory, all accesses to a memory location have been access ordered,
and the CMO instructions defined in this extension are guaranteed to operate on
a path up to the PoC-memory.</p>
</div>
<div id="__asciidoctor-preview-54__" class="paragraph">
<p><strong><em>FIXME:</em></strong> Define other standard PoCs?</p>
</div>
<div id="__asciidoctor-preview-55__" class="paragraph">
<p>A system may define additional custom PoCs before the PoC-memory, and when such
a PoC is specified in a CMO instruction, the instruction <em>must</em> operate on a
given path up to the custom PoC and may operate on the path up to the
PoC-memory.
A CMO instruction is <em>not</em> required, however, to operate on the path beyond a
custom PoC.</p>
</div>
<div id="__asciidoctor-preview-56__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-57__" class="paragraph">
<p><em>The above definition allows an implementation to perform all operations to</em>
<em>custom PoCs before the PoC-memory as if such operations were performed to the</em>
<em>PoC-memory.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-58__" class="paragraph">
<p>While traversing a given path, a memory access from a CMO instruction operates
on the caches up to the specified PoC.
Between a system agent and the first PoC on the path, the memory access
operates on private caches, and between subsequent PoCs, the memory access
operates on shared caches.
There is no requirement, however, for any caches to be present either between a
system agent and the first PoC or between subsequent PoCs.
Caches on the path are accessed <em>directly</em> by the memory access.
Additional caches on the paths that converge at a given PoC may be accessed
<em>indirectly</em> depending on the memory attributes associated with a memory access
and any <em>implementation-defined</em> cache coherence mechanisms.</p>
</div>
<div id="__asciidoctor-preview-59__" class="paragraph">
<p>Systems may implement hardware cache coherence mechanisms to ensure that the
copies in a set of caches remain <em>coherent</em> with respect to each other, i.e.
the copies in the set of caches appear to have the same data values, regardless
of which cache in the set is accessed.
The set of caches on which hardware can maintain this property corresponds to a
<em>hardware coherence domain</em> (or <em>domain</em> for short), which may consist of any
number of caches, including an individual cache.
Only a subset of the caches in a domain may be accessed depending on the memory
attributes of a memory access and the cache coherence protocol.</p>
</div>
<div id="__asciidoctor-preview-60__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-61__" class="paragraph">
<p><em>A hardware cache coherence protocol may add additional cache states and may</em>
<em>cause additional cache block state transitions.</em>
<em>The effects of a hardware cache coherence protocol on cache block states are</em>
<em>beyond the scope of this specification.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-62__" class="paragraph">
<p>If two caches are in different domains, the copies in those caches are
<em>non-coherent</em> with respect to each other.
In addition, two copies in different caches within the same domain are also
non-coherent with respect to each other if the memory attributes of a memory
access do not require both caches to be accessed.
Non-coherent copies may appear to have different data values, or the copies may
appear to have the same data values.
Software may enforce coherence on non-coherent copies using CMO instructions.</p>
</div>
<div id="__asciidoctor-preview-63__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-64__" class="paragraph">
<p><em>The term</em> coherent <em>implies a guarantee of coherence, while the term</em>
non-coherent <em>implies only the lack of such a guarantee, not a guarantee of</em>
<em>non-coherence.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-65__" class="paragraph">
<p>Domains correspond to particular PoCs.
A <em>PoC-domain</em> (working title) is defined to be the PoC at which all paths that
pass through any cache in the domain before the PoC converge.
Systems may have any number of PoCs-domain visible to software via memory
attributes or as custom PoCs.
In addition, a domain may be asymmetric with respect to the paths that converge
at a PoC-domain.
Specifically, a memory access on one path may indirectly access the caches on a
second path, while a memory access on the second path may <em>not</em> indirectly
access the caches on the first.</p>
</div>
<div id="__asciidoctor-preview-66__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-67__" class="paragraph">
<p><em>This extension does not prohibit system agents from bypassing the PoC-memory</em>
<em>to access a memory location, nor does the extension prohibit memory caches</em>
<em>beyond the PoC-memory.</em>
<em>However, in such a system, software cannot expect the currently defined cache</em>
<em>operations to have the desired effects with respect to those system agents or</em>
<em>caches.</em></p>
</div>
<div id="__asciidoctor-preview-68__" class="paragraph">
<p><em>Additional system topology beyond the PoC-memory may be specified in future</em>
<em>extensions.</em>
<em>For example, additional points of convergence may be defined to manage memory</em>
<em>caches, or various points of persistence may be defined to support different</em>
<em>classes of storage.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-69__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-70__" class="paragraph">
<p>Below are some properties/implications of the above definitions:</p>
</div>
<div id="__asciidoctor-preview-71__" class="ulist">
<ul>
<li id="__asciidoctor-preview-72__">
<p>Paths form a tree with the system agents as leaves and the PoC-memory as the
root; intermediate PoCs are nodes on the tree, while caches lie on the edges</p>
<div id="__asciidoctor-preview-73__" class="ulist">
<ul>
<li id="__asciidoctor-preview-74__">
<p>For example, a private L1 and L2 cache lie on the edge between a system
agent and the first PoC</p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-75__">
<p>PoCs establish a hierarchy</p>
<div id="__asciidoctor-preview-76__" class="ulist">
<ul>
<li id="__asciidoctor-preview-77__">
<p>At each PoC, the set of agents whose memory accesses are ordered is the
union of the sets defined by the previous PoCs</p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-78__">
<p>Memory accesses on a path obey uniprocessor semantics</p>
</li>
<li id="__asciidoctor-preview-79__">
<p>Caches on the path from a domain PoC to the next PoC are effectively part of
the domain</p>
</li>
<li id="__asciidoctor-preview-80__">
<p>Caches between PoCs are effectively part of the same domain</p>
<div id="__asciidoctor-preview-81__" class="ulist">
<ul>
<li id="__asciidoctor-preview-82__">
<p>The access order of caches between PoCs is implementation-defined (?)</p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-83__">
<p>PoCs and domains</p>
</li>
<li id="__asciidoctor-preview-84__">
<p>PoCs are accessed serially (?)</p>
</li>
</ul>
</div>
</div>
</div>
<div id="__asciidoctor-preview-85__" class="sidebarblock">
<div class="content">
<div class="title">Ignore Me</div>
<div id="__asciidoctor-preview-86__" class="paragraph">
<p>Random stuff being worked on:</p>
</div>
<div id="__asciidoctor-preview-87__" class="paragraph">
<p>memory accesses due to loads and stores can be ordered anywhere in a domain, but the
ultimate point of ordering for the domain is the PoC-domain.
memory accesses due to CMOs operate to a PoC-domain and guarantee the whole domain
has been operated on</p>
</div>
<div id="__asciidoctor-preview-88__" class="paragraph">
<p>SW view: POCs define sets of agents that communicate coherently without SW help</p>
</div>
<div id="__asciidoctor-preview-89__" class="paragraph">
<p><strong><em>FIXME:</em></strong> Domains can be mapped outward; within the frontier, outside the frontier</p>
</div>
<div id="__asciidoctor-preview-90__" class="paragraph">
<p>Is there such a thing as a PoC-hart that represents uniprocessor ordering?
That makes the tree definition a bit more easy since a leaf becomes a PoC (but
nothing is really converging, unless you consider loads and stores as separate
things converging)</p>
</div>
<div id="__asciidoctor-preview-91__" class="paragraph">
<p>Structural definition: relative to system agent. L1 is the "first" cache accessed, etc.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixme_pma_behaviors">2.2.1. FIXME: PMA Behaviors</h4>
<div id="__asciidoctor-preview-92__" class="paragraph">
<p>FIXME: Coherence and cacheability attributes&#8230;&#8203;</p>
</div>
<div id="__asciidoctor-preview-93__" class="paragraph">
<p>Ignore cacheability to enable changes in attribute</p>
</div>
<div id="__asciidoctor-preview-94__" class="paragraph">
<p>Non-coherent implies that no caches are accessed indirectly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fixme_memory_ordering">2.3. FIXME: Memory Ordering</h3>
<div class="sect3">
<h4 id="_preserved_program_order">2.3.1. Preserved Program Order</h4>
<div id="__asciidoctor-preview-95__" class="paragraph">
<p>The preserved program order (abbreviated <em>PPO</em> below) rules are defined by the
RVWMO memory ordering model.
How the operations resulting from CMO instructions fit into these rules
is described below.</p>
</div>
<div id="__asciidoctor-preview-96__" class="paragraph">
<p>For cache block management instructions, the resulting invalidate, clean, and
flush operations behave as stores in the PPO rules subject to one additional
overlapping address rule. Specifically, if <em>a</em> precedes <em>b</em> in program order,
then <em>a</em> will precede <em>b</em> in the global memory order if:</p>
</div>
<div id="__asciidoctor-preview-97__" class="ulist">
<ul>
<li id="__asciidoctor-preview-98__">
<p><em>a</em> is an invalidate, clean, or flush, <em>b</em> is a load, and <em>a</em> and <em>b</em> access
overlapping memory addresses</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-99__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-100__" class="paragraph">
<p><em>The above rule ensures that a subsequent load operation in program order never
appears in the global memory order before a preceding invalidate, clean, or
flush operation to an overlapping address.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-101__" class="paragraph">
<p>For cache block write instructions, the resulting write operations simply
behave as stores in the PPO rules.</p>
</div>
<div id="__asciidoctor-preview-102__" class="paragraph">
<p>As cache block hint instructions do not modify architectural memory state, the
resulting operations are <em>not</em> ordered by the PPO rules.</p>
</div>
</div>
<div class="sect3">
<h4 id="_load_values">2.3.2. Load Values</h4>
<div id="__asciidoctor-preview-103__" class="paragraph">
<p>In addition, an invalidate operation changes the set of values that may be
returned by a load. In particular, a third condition is added to the Load Value
Axiom:</p>
</div>
<div id="__asciidoctor-preview-104__" class="olist arabic">
<ol class="arabic" start="3">
<li id="__asciidoctor-preview-105__">
<p>If an invalidate precedes <em>i</em> in program order and operates on a byte, and no
store to that byte appears in program order or in the global memory order
between the invalidate and <em>i</em>, the load value is <em>implementation-defined</em></p>
</li>
</ol>
</div>
<div id="__asciidoctor-preview-106__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-107__" class="paragraph">
<p>What does global memory order mean for software managed coherence:</p>
</div>
<div id="__asciidoctor-preview-108__" class="ulist">
<ul>
<li id="__asciidoctor-preview-109__">
<p>Can describe global to mean "global" for all agents and domains (single universe)</p>
</li>
<li id="__asciidoctor-preview-110__">
<p>Can describe global to mean "global" for some agents and domains (a multiverse)</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-111__" class="paragraph">
<p>The above definition is written using a multiverse definition for global memory
order. A single universe definition would constrain the result to orders that
could be produced by other agents. Maybe&#8230;&#8203;?</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ordering_events">2.3.3. Ordering Events</h4>
<div id="__asciidoctor-preview-112__" class="paragraph">
<p>Ordering event for CMO: access ordered at explicit PoC(-domain)</p>
</div>
<div id="__asciidoctor-preview-113__" class="paragraph">
<p>Ordering event for load: access ordered in the implicit domain</p>
</div>
<div id="__asciidoctor-preview-114__" class="paragraph">
<p>Ordering event for store: access ordered in the implicit domain</p>
</div>
<div id="__asciidoctor-preview-115__" class="paragraph">
<p>PPO specifies the order of the ordering events</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fixme_discovery">2.4. FIXME: Discovery</h3>
<div id="__asciidoctor-preview-116__" class="paragraph">
<p>FIXME: HW vs. SW</p>
</div>
<div id="__asciidoctor-preview-117__" class="paragraph">
<p>For now, fixed size across all harts and devices that share a domain</p>
</div>
</div>
<div class="sect2">
<h3 id="_traps">2.5. Traps</h3>
<div class="sect3">
<h4 id="_illegal_instruction_and_virtual_instruction_exceptions">2.5.1. Illegal Instruction and Virtual Instruction Exceptions</h4>
<div id="__asciidoctor-preview-118__" class="paragraph">
<p>Cache block management instructions and cache block write instructions may take
an illegal instruction exception depending on the <em>current privilege mode</em> and
the state of the CMO control registers described in the <a href="#_csrs">CSRs</a> section.
The current privilege mode refers to the privilege mode of the hart at the time
the instruction is executed.</p>
</div>
<div id="__asciidoctor-preview-119__" class="paragraph">
<p>Cache block hint instructions do <em>not</em> take illegal instruction exceptions.</p>
</div>
<div id="__asciidoctor-preview-120__" class="paragraph">
<p>Additionally, CMO instructions do <em>not</em> take virtual instruction exceptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_page_fault_and_guest_page_fault_exceptions">2.5.2. Page Fault and Guest-Page Fault Exceptions</h4>
<div id="__asciidoctor-preview-121__" class="paragraph">
<p>During address translation, CMO instructions may take a page fault depending on
the type of instruction, the <em>effective privilege mode</em> (as determined by the
<code>MPRV</code>, <code>MPV</code>, and <code>MPP</code> bits in <code>mstatus</code>) of the resulting access, and the
permissions granted by the page table entry (PTE).
If two-stage address translation is enabled, CMO instructions may also take a
guest-page fault.</p>
</div>
<div id="__asciidoctor-preview-122__" class="paragraph">
<p>Cache block management instructions require a valid translation (<code>V=1</code>) and
either read (<code>R=1</code>) or execute (<code>X=1</code>) permission and, if applicable, user
access (<code>U=1</code>) in the effective privilege mode.
If these conditions are <em>not</em> met, the instruction takes a store/AMO page fault
exception.
In addition, <code>CBO.INVAL</code> instructions may take a store/AMO page fault exception
depending on the state of the CMO control registers described in the <a href="#_csrs">CSRs</a>
section and whether the access has been granted write permission by the PTE.</p>
</div>
<div id="__asciidoctor-preview-123__" class="paragraph">
<p>Cache block write instructions require a valid translation (<code>V=1</code>) and write
(<code>W=1</code>) permission and, if applicable, user access (<code>U=1</code>) in the effective
privilege mode.
If these conditions are <em>not</em> met, the instruction takes a store/AMO page fault
exception.</p>
</div>
<div id="__asciidoctor-preview-124__" class="paragraph">
<p>If G-stage address translation is enabled, the above instructions take a
store/AMO guest-page fault if the G-stage PTE does <em>not</em> allow the access.</p>
</div>
<div id="__asciidoctor-preview-125__" class="paragraph">
<p>Cache block hint instructions require a valid translation (<code>V=1</code>) and either
read (<code>R=1</code>) or execute (<code>X=1</code>) permission and, if applicable, user access
(<code>U=1</code>) in the effective privilege mode.
If these conditions are <em>not</em> met, however, the instruction does <em>not</em> take a
page fault or guest-page fault exception and retires without accessing memory.</p>
</div>
<div id="__asciidoctor-preview-126__" class="paragraph">
<p>FIXME: PREFETCH.W interacts with LR/SC; doesn&#8217;t require W=1</p>
</div>
<div class="sect4">
<h5 id="_effect_of_other_xstatus_bits">Effect of other <code>xstatus</code> bits</h5>
<div id="__asciidoctor-preview-127__" class="paragraph">
<p>The <code>mstatus.MXR</code> bit (also <code>sstatus.MXR</code>) and the <code>vsstatus.MXR</code> bit do <em>not</em>
affect the execution of CMO instructions.</p>
</div>
<div id="__asciidoctor-preview-128__" class="paragraph">
<p>The <code>mstatus.SUM</code> bit (also <code>sstatus.SUM</code>) and the <code>vsstatus.SUM</code> bit do <em>not</em>
affect the execution of CMO instructions beyond modifying permissions for
S/HS-mode and VS-mode accesses as specified by the privileged architecture.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_access_fault_exception">2.5.3. Access Fault Exception</h4>
<div id="__asciidoctor-preview-129__" class="paragraph">
<p>A CMO instruction may take an access fault exception, as detailed in the
privileged architecture specification, that interrupts the address translation
process.
Assuming the address translation process completes with a valid translation, a
CMO instruction may also take an access fault exception depending on the type
of instruction, the effective privilege mode of the resulting access, and the
permissions granted by the physical memory protection (PMP) unit and the
physical memory attributes (PMAs).</p>
</div>
<div id="__asciidoctor-preview-130__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-131__" class="paragraph">
<p><em>For now, we assume two things about PMAs:</em></p>
</div>
<div id="__asciidoctor-preview-132__" class="olist arabic">
<ol class="arabic">
<li id="__asciidoctor-preview-133__">
<p><em>PMAs are the same for all physical addresses in a cache block</em></p>
</li>
<li id="__asciidoctor-preview-134__">
<p><em>Memory that can be cached cannot be write-only</em></p>
</li>
</ol>
</div>
</div>
</div>
<div id="__asciidoctor-preview-135__" class="paragraph">
<p>Read (<code>R</code>), write (<code>W</code>), and execute (<code>X</code>) permissions are granted by the PMP
and the PMAs.
Although the PMP may grant different permissions to different physical
addresses in a cache block, the PMAs for a cache block <em>must</em> be the same for
<em>all</em> physical addresses in the cache block and read permission <em>must</em> be
granted if write permission has been granted.
If these PMA constraints are <em>not</em> met, the behavior of CMO instruction is
UNSPECIFIED.</p>
</div>
<div id="__asciidoctor-preview-136__" class="paragraph">
<p>For the purposes of access fault determination, <em>joint permission</em> is granted
for a given physical address when the same access type is allowed by both the
PMP and the PMAs for that physical address.
For example, joint read permission implies that both the PMP and PMAs allow
a read access.
In addition, for a given cache block, <em>partial joint write permission</em> implies
that joint write permission has been granted to only <em>some</em> of the physical
addresses in the cache block, while <em>full joint write permission</em> implies that
joint write permission has been granted to <em>all</em> physical addresses in the
cache block.</p>
</div>
<div id="__asciidoctor-preview-137__" class="paragraph">
<p>Cache block management instructions require either joint read or joint execute
permission for <em>all</em> accessed physical addresses.
If this condition is <em>not</em> met, the instruction takes a store/AMO access fault
exception.
In addition, <code>CBO.INVAL</code> instructions may take a store/AMO access fault
exception depending on the state of the CMO control registers described in the
<a href="#_csrs">CSRs</a> section and whether the access has been granted partial joint write
permission by the PMP and PMAs.</p>
</div>
<div id="__asciidoctor-preview-138__" class="paragraph">
<p>Cache block write instructions require full joint write permission.
If this condition is <em>not</em> met, the instruction takes a store/AMO access fault
exception.</p>
</div>
<div id="__asciidoctor-preview-139__" class="paragraph">
<p>Cache block hint instructions require either joint read or joint execute
permission for <em>all</em> accessed physical addresses.
If this condition is <em>not</em> met, however, the instruction does <em>not</em> take an
access fault exception and retires without accessing memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_address_misaligned_exception">2.5.4. Address Misaligned Exception</h4>
<div id="__asciidoctor-preview-140__" class="paragraph">
<p>CMO instructions do <em>not</em> generate address misaligned exceptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_breakpoint_exception">2.5.5. Breakpoint Exception</h4>
<div id="__asciidoctor-preview-141__" class="paragraph">
<p>CMO instructions may generate breakpoint exceptions (or may cause other debug
actions) subject to the general trigger module behaviors specified in the debug
architecture.
When <code>type=2</code> (i.e. <code>mcontrol</code>), the behavior of a trigger for load and store
address matches is UNSPECIFIED for CMO instructions.
When <code>type=6</code> (i.e. <code>mcontrol6</code>), the behavior of a trigger for load and store
address matches is based on the following classification of a CMO instruction:</p>
</div>
<div id="__asciidoctor-preview-142__" class="ulist">
<ul>
<li id="__asciidoctor-preview-143__">
<p>A cache block management instruction is both a load and a store</p>
</li>
<li id="__asciidoctor-preview-144__">
<p>A cache block write instruction is a store</p>
</li>
<li id="__asciidoctor-preview-145__">
<p>It is <em>implementation-defined</em> whether a cache block hint instruction is both
a load and a store or neither a load nor a store</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-146__" class="paragraph">
<p>Load and store data matches for all CMO instructions are UNSPECIFIED.</p>
</div>
<div id="__asciidoctor-preview-147__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-148__" class="paragraph">
<p><em>An implementation may convert cache block hint instructions into NOPs prior to
executing the instruction. Load and store matches are not applicable in such an
implementation.</em></p>
</div>
<div id="__asciidoctor-preview-149__" class="paragraph">
<p><em>For load and store address matches on a CMO effective address, software should
program the trigger to match on NAPOT ranges, i.e. <code>mcontrol6.match=1</code>, and
should program the NAPOT range to equal the cache block size.</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_formats">3. Formats</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_csrs">3.1. CSRs</h3>
<div id="__asciidoctor-preview-150__" class="paragraph">
<p><strong><em>FIXME</em></strong>: How is this extension disabled?</p>
</div>
<div id="__asciidoctor-preview-151__" class="paragraph">
<p>Four CSRs control execution of CMO instructions:</p>
</div>
<div id="__asciidoctor-preview-152__" class="ulist">
<ul>
<li id="__asciidoctor-preview-153__">
<p><code>mcmocontrol</code></p>
</li>
<li id="__asciidoctor-preview-154__">
<p><code>scmocontrol</code></p>
</li>
<li id="__asciidoctor-preview-155__">
<p><code>hcmocontrol</code></p>
</li>
<li id="__asciidoctor-preview-156__">
<p><code>vscmocontrol</code></p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-157__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-158__" class="paragraph">
<p><em>The <code>scmocontrol</code> and <code>vscmocontrol</code> registers are both required to
distinguish CMO execution behavior when the effective privilege mode is U-mode
or VU-mode, respectively.</em>
<em>These registers are only present if the H-extension is implemented and
enabled.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-159__" class="paragraph">
<p>Each <code>xcmocontrol</code> register has the following generic format:</p>
</div>
<table id="__asciidoctor-preview-160__" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Generic Format for xcmocontrol CSRs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[0]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CBME</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Cache Block Management instruction Enable</p>
</div>
<div class="paragraph">
<p>Determines the behavior of a cache block management instruction (i.e.
<code>CBO.INVAL</code>, <code>CBO.CLEAN</code>, or <code>CBO.FLUSH</code>) when the instruction is executed in
<em>privilege_mode</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction takes an illegal instruction exception</p>
</li>
<li>
<p><code>1</code>: The instruction is executed</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[1]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CBWE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Cache Block Write instruction Enable</p>
</div>
<div class="paragraph">
<p>Determines the behavior of a cache block write instruction (i.e. <code>CBO.ZERO</code>)
when the instruction is executed in <em>privilege_mode</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction takes an illegal instruction exception</p>
</li>
<li>
<p><code>1</code>: The instruction is executed</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[7:2]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Rsvd</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>Reserved</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[8]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INVW0I</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CBO.INVAL</code> access without write permission performs an
Invalidate operation</p>
</div>
<div class="paragraph">
<p>Determines the operation performed by a <code>CBO.INVAL</code> instruction when the
resulting access <em>has not been</em> granted write permission in the effective
privilege mode (<em>Wx</em>=<code>W0</code>) and when the instruction does <em>not</em> raise an
exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction performs a flush operation</p>
</li>
<li>
<p><code>1</code>: The instruction performs an invalidate operation</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[9]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INVW0E</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CBO.INVAL</code> access without write permission Enable</p>
</div>
<div class="paragraph">
<p>Determines the behavior of a <code>CBO.INVAL</code> instruction when a
<em>protection_mechanism</em> is enabled and the resulting access <em>has not been</em>
granted write permission in the effective privilege mode (<em>Wx</em>=<code>W0</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction takes an exception (page fault, guest-page fault, or
access fault depending on the CSR)</p>
</li>
<li>
<p><code>1</code>: The instruction performs an operation based on <code>INVW0I</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[10]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INVW1I</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CBO.INVAL</code> access with write permission performs an
Invalidate operation</p>
</div>
<div class="paragraph">
<p>Determines the operation performed by a <code>CBO.INVAL</code> instruction when the
resulting access <em>has been</em> granted write permission in the effective privilege
mode (<em>Wx</em>=<code>W1</code>) and when the instruction does <em>not</em> raise an exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction performs a flush operation</p>
</li>
<li>
<p><code>1</code>: The instruction performs an invalidate operation</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[11]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INVW1E</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CBO.INVAL</code> access with write permission Enable</p>
</div>
<div class="paragraph">
<p>Determines the behavior of a <code>CBO.INVAL</code> instruction when a
<em>protection_mechanism</em> is enabled and the resulting access <em>has been</em> granted
write permission in the effective privilege mode (<em>Wx</em>=<code>W1</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: The instruction takes an exception (page fault, guest-page fault, or
access fault depending on the CSR)</p>
</li>
<li>
<p><code>1</code>: The instruction performs an operation based on <code>INVW1I</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">[x:12]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Rsvd</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>Reserved</em></p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="__asciidoctor-preview-188__" class="paragraph">
<p>Each <code>xcmocontrol</code> register is WARL, where CSR reads return the behaviors
supported by the implementation.</p>
</div>
<div id="__asciidoctor-preview-189__" class="paragraph">
<p>The following subsections detail how the <code>xcmocontrol</code> CSRs govern the
execution of CMO instructions.</p>
</div>
<div class="sect4">
<h5 id="_determining_illegal_instruction_exceptions">Determining Illegal Instruction Exceptions</h5>
<div id="__asciidoctor-preview-190__" class="paragraph">
<p>The descriptions for the <code>CBME</code> and <code>CBZE</code> bits in the <code>xcmocontrol</code> registers
include a <em>privilege_mode</em> parameter that corresponds to the privilege modes
controlled by a given CSR. Each CSR defines this parameter as follows:</p>
</div>
<div id="__asciidoctor-preview-191__" class="ulist">
<ul>
<li id="__asciidoctor-preview-192__">
<p>For <code>mcmocontrol</code>, <em>privilege_mode</em> corresponds to S/HS-mode, U-mode,
VS-mode, and VU-mode</p>
</li>
<li id="__asciidoctor-preview-193__">
<p>For <code>scmocontrol</code>, <em>privilege_mode</em> corresponds to U-mode</p>
</li>
<li id="__asciidoctor-preview-194__">
<p>For <code>hcmocontrol</code>, <em>privilege_mode</em> corresponds to VS-mode and VU-mode</p>
</li>
<li id="__asciidoctor-preview-195__">
<p>For <code>vscmocontrol</code>, <em>privilege_mode</em> corresponds to VU-mode</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-196__" class="paragraph">
<p>Depending on the <em>current privilege mode</em>, a cache block management instruction
takes an illegal instruction exception based on the <code>CBME</code> bits:</p>
</div>
<div id="__asciidoctor-preview-197__" class="ulist">
<ul>
<li id="__asciidoctor-preview-198__">
<p>M-mode:<br>
<code>FALSE</code> (cache block management instructions never take illegal instruction
exceptions)</p>
</li>
<li id="__asciidoctor-preview-199__">
<p>S/HS-mode:<br>
<code>!mcmocontrol.CBME</code></p>
</li>
<li id="__asciidoctor-preview-200__">
<p>U-mode:<br>
<code>!mcmocontrol.CBME || !scmocontrol.CBME</code></p>
</li>
<li id="__asciidoctor-preview-201__">
<p>VS-mode:<br>
<code>!mcmocontrol.CBME || !hcmocontrol.CBME</code></p>
</li>
<li id="__asciidoctor-preview-202__">
<p>VU-mode:<br>
<code>!mcmocontrol.CBME || !hcmocontrol.CBME || !vscmocontrol.CBME</code></p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-203__" class="paragraph">
<p>Depending on the <em>current privilege mode</em>, a cache block write instruction
takes an illegal instruction exception based on the <code>CBWE</code> bits:</p>
</div>
<div id="__asciidoctor-preview-204__" class="ulist">
<ul>
<li id="__asciidoctor-preview-205__">
<p>M-mode:<br>
<code>FALSE</code> (cache block write instructions never take illegal instruction
exceptions)</p>
</li>
<li id="__asciidoctor-preview-206__">
<p>S/HS-mode:<br>
<code>!mcmocontrol.CBWE</code></p>
</li>
<li id="__asciidoctor-preview-207__">
<p>U-mode:<br>
<code>!mcmocontrol.CBWE || !scmocontrol.CBWE</code></p>
</li>
<li id="__asciidoctor-preview-208__">
<p>VS-mode:<br>
<code>!mcmocontrol.CBWE || !hcmocontrol.CBWE</code></p>
</li>
<li id="__asciidoctor-preview-209__">
<p>VU-mode:<br>
<code>!mcmocontrol.CBWE || !hcmocontrol.CBWE || !vscmocontrol.CBWE</code></p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-210__" class="paragraph">
<p>Otherwise, the above instructions are executed in the <em>current privilege mode</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_determining_page_fault_guest_page_fault_and_access_fault_exceptions">Determining Page Fault, Guest-Page Fault, and Access Fault Exceptions</h5>
<div id="__asciidoctor-preview-211__" class="paragraph">
<p>The descriptions for the <code>INVWxE</code> and <code>INVWxI</code> bits in the <code>xcmocontrol</code>
registers include a <em>protection_mechanism</em> parameter that corresponds to the
protection mechanism that determines write permission for an access and a
<em>Wx</em> parameter that represents whether write permission has been granted (<code>W1</code>)
or not (<code>W0</code>).
Each CSR defines these as follows:</p>
</div>
<div id="__asciidoctor-preview-212__" class="ulist">
<ul>
<li id="__asciidoctor-preview-213__">
<p>For <code>mcmocontrol</code>, <em>protection_mechanism</em> corresponds to the PMP and PMAs
and <em>Wx</em> corresponds to whether partial joint write permission has been
granted by the PMP and PMAs</p>
</li>
<li id="__asciidoctor-preview-214__">
<p>For <code>scmocontrol</code>, <em>protection_mechanism</em> corresponds to the <code>satp</code> page
table and <em>Wx</em> corresponds to whether write permission has been granted by
the leaf PTE <code>W</code> bit</p>
</li>
<li id="__asciidoctor-preview-215__">
<p>For <code>hcmocontrol</code>, <em>protection_mechanism</em> corresponds to the <code>hgatp</code> page
table and <em>Wx</em> corresponds to whether write permission has been granted by
the leaf PTE <code>W</code> bit</p>
</li>
<li id="__asciidoctor-preview-216__">
<p>For <code>vscmocontrol</code>, <em>protection_mechanism</em> corresponds to the <code>vsatp</code> page
table and <em>Wx</em> corresponds to whether write permission has been granted by
the leaf PTE <code>W</code> bit</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-217__" class="paragraph">
<p>For each CSR, the resulting <code>INVWxE</code> value is determined by the designated
<em>protection_mechanism</em>, which selects the <code>INVW0E</code> bit if <em>Wx</em>=<code>W0</code> or the
<code>INVW1E</code> bit if <em>Wx</em>=<code>W1</code>.
Depending on the <em>effective privilege mode</em>, a <code>CBO.INVAL</code> instruction takes
the following types of traps based on the <code>INVWxE</code> values:</p>
</div>
<div id="__asciidoctor-preview-218__" class="ulist">
<ul>
<li id="__asciidoctor-preview-219__">
<p>M-mode:</p>
<div id="__asciidoctor-preview-220__" class="ulist">
<ul>
<li id="__asciidoctor-preview-221__">
<p><em>N/A</em> (<code>CBO.INVAL</code> never faults due to the CMO control registers)</p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-222__">
<p>S/HS-mode:</p>
<div id="__asciidoctor-preview-223__" class="ulist">
<ul>
<li id="__asciidoctor-preview-224__">
<p>Access fault:<br>
<code>!(mcmocontrol.INVWxE)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-225__">
<p>U-mode:</p>
<div id="__asciidoctor-preview-226__" class="ulist">
<ul>
<li id="__asciidoctor-preview-227__">
<p>Page fault:<br>
<code>!(scmocontrol.INVWxE || satp.MODE==Bare)</code></p>
</li>
<li id="__asciidoctor-preview-228__">
<p>Access fault:<br>
<code>(scmocontrol.INVWxE || satp.MODE==Bare) &amp;&amp;</code><br>
<code>!(mcmocontrol.INVWxE)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-229__">
<p>VS-mode:</p>
<div id="__asciidoctor-preview-230__" class="ulist">
<ul>
<li id="__asciidoctor-preview-231__">
<p>Guest-page fault:<br>
<code>!(hcmocontrol.INVWxE || hgatp.MODE==Bare)</code></p>
</li>
<li id="__asciidoctor-preview-232__">
<p>Access fault:<br>
<code>(hcmocontrol.INVWxE || hgatp.MODE==Bare) &amp;&amp;</code><br>
<code>!(mcmocontrol.INVWxE)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-233__">
<p>VU-mode:</p>
<div id="__asciidoctor-preview-234__" class="ulist">
<ul>
<li id="__asciidoctor-preview-235__">
<p>Page fault:<br>
<code>!(vscmocontrol.INVWxE || vsatp.MODE==Bare)</code></p>
</li>
<li id="__asciidoctor-preview-236__">
<p>Guest-page fault:<br>
<code>(vscmocontrol.INVWxE || vsatp.MODE==Bare) &amp;&amp;</code><br>
<code>!(hcmocontrol.INVWxE || hgatp.MODE==Bare)</code></p>
</li>
<li id="__asciidoctor-preview-237__">
<p>Access fault:<br>
<code>(vscmocontrol.INVWxE || vsatp.MODE==Bare) &amp;&amp;</code><br>
<code>(hcmocontrol.INVWxE || hgatp.MODE==Bare) &amp;&amp;</code><br>
<code>!(mcmocontrol.INVWxE)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-238__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-239__" class="paragraph">
<p><em>The above exception priorities reflect the architected exception priorities in
the privileged architecture specification.</em></p>
</div>
</div>
</div>
<div id="__asciidoctor-preview-240__" class="paragraph">
<p>For each CSR, the resulting <code>INVWxI</code> value is determined by the designated
<em>protection_mechanism</em>, which selects the <code>INVW0I</code> bit if <em>Wx</em>=<code>W0</code> or the
<code>INVW1I</code> bit if <em>Wx</em>=<code>W1</code>, if that protection mechanism is enabled.
If the protection mechanism is disabled, the <code>INVWxI</code> value is the logical AND
of the <code>INVW0I</code> bit and the <code>INVW1I</code> bit, i.e. both bits <em>must</em> be set to
perform an invalidate operation.
Assuming that no exception arises and depending on the
<em>effective privilege mode</em>, a <code>CBO.INVAL</code> instruction performs the following
operations based on the <code>INVWxI</code> values:</p>
</div>
<div id="__asciidoctor-preview-241__" class="ulist">
<ul>
<li id="__asciidoctor-preview-242__">
<p>M-mode:</p>
<div id="__asciidoctor-preview-243__" class="ulist">
<ul>
<li id="__asciidoctor-preview-244__">
<p>Flush:<br>
<code>FALSE</code> (<code>CBO.INVAL</code> never performs a flush operation)</p>
</li>
<li id="__asciidoctor-preview-245__">
<p>Invalidate:<br>
<code>TRUE</code> (<code>CBO.INVAL</code> always performs an invalidate operation)</p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-246__">
<p>S-mode:</p>
<div id="__asciidoctor-preview-247__" class="ulist">
<ul>
<li id="__asciidoctor-preview-248__">
<p>Flush:<br>
<code>!(mcmocontrol.INVWxI)</code></p>
</li>
<li id="__asciidoctor-preview-249__">
<p>Invalidate:<br>
<code>(mcmocontrol.INVWxI)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-250__">
<p>U-mode:</p>
<div id="__asciidoctor-preview-251__" class="ulist">
<ul>
<li id="__asciidoctor-preview-252__">
<p>Flush:<br>
<code>!(scmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
<li id="__asciidoctor-preview-253__">
<p>Invalidate:<br>
<code>(scmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-254__">
<p>VS-mode:</p>
<div id="__asciidoctor-preview-255__" class="ulist">
<ul>
<li id="__asciidoctor-preview-256__">
<p>Flush:<br>
<code>!(hcmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
<li id="__asciidoctor-preview-257__">
<p>Invalidate:<br>
<code>(hcmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
</ul>
</div>
</li>
<li id="__asciidoctor-preview-258__">
<p>VU-mode:</p>
<div id="__asciidoctor-preview-259__" class="ulist">
<ul>
<li id="__asciidoctor-preview-260__">
<p>Flush:<br>
<code>!(vscmocontrol.INVWxI &amp;&amp; hcmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
<li id="__asciidoctor-preview-261__">
<p>Invalidate:<br>
<code>(vscmocontrol.INVWxI &amp;&amp; hcmocontrol.INVWxI &amp;&amp; mcmocontrol.INVWxI)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-262__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-263__" class="paragraph">
<p><em>Until a modified cache block has updated memory, a <code>CBO.INVAL</code> instruction may
expose stale data values in memory if the CSRs are programmed to perform an
invalidate operation.</em>
<em>This behavior may result in a security hole if lower privileged level software
performs an invalidate operation and accesses sensitive information in memory.</em>
<em>To avoid such holes, higher privileged level software must perform either a
clean or flush operation on the cache block before permitting lower privileged
level software to perform an invalidate operation on the block.</em></p>
</div>
<div id="__asciidoctor-preview-264__" class="paragraph">
<p><em>Alternatively, higher privileged level software may program the CSRs so that
<code>CBO.INVAL</code> either traps or performs a flush operation in a lower privileged
level.</em>
<em>The W0 and W1 bits allow higher privileged software finer-grained control of
the behavior of <code>CBO.INVAL</code> in lower privilege levels based on whether write
permission has been granted to that level by a particular protection
mechanism.</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions">4. Instructions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cache_block_management_instructions">4.1. Cache Block Management Instructions</h3>
<div id="__asciidoctor-preview-265__" class="paragraph">
<p>Cache block management instructions operate on the cache blocks containing the
effective address specified in <em>rs1</em>.
These instructions also specify a <em>PoC</em> that, along with the coherence PMA,
determines the set of caches on which the operation is performed.
In particular, the set of caches consists of one of the following:</p>
</div>
<div id="__asciidoctor-preview-266__" class="ulist">
<ul>
<li id="__asciidoctor-preview-267__">
<p>If the coherence PMA indicates that hardware enforces coherence on the
physical address, all the caches accessed by the hart directly and indirectly
in the coherence domains on the path from the hart to the <em>PoC</em></p>
</li>
<li id="__asciidoctor-preview-268__">
<p>If the coherence PMA indicates that hardware does <em>not</em> enforce coherence on
the physical address, only the caches accessed by the hart directly on the
path from the hart to the <em>PoC</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_cbo_inval">4.1.1. <code>CBO.INVAL</code></h4>
<div id="__asciidoctor-preview-269__" class="paragraph">
<p>A <code>CBO.INVAL</code> instruction performs an <em>invalidate</em> operation or a <em>flush</em>
operation, depending on the state of the CMO CSRs, on the set of caches
determined by the <em>PoC</em> and the coherence PMA.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cbo_clean">4.1.2. <code>CBO.CLEAN</code></h4>
<div id="__asciidoctor-preview-270__" class="paragraph">
<p>A <code>CBO.CLEAN</code> instruction performs a <em>clean</em> operation on the set of caches
determined by the <em>PoC</em> and the coherence PMA.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cbo_flush">4.1.3. <code>CBO.FLUSH</code></h4>
<div id="__asciidoctor-preview-271__" class="paragraph">
<p>A <code>CBO.FLUSH</code> instruction performs a <em>flush</em> operation on the set of caches
determined by the <em>PoC</em> and the coherence PMA.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cache_block_write_instruction">4.2. Cache Block Write Instruction</h3>
<div id="__asciidoctor-preview-272__" class="paragraph">
<p>Cache block write instructions operate on the cache blocks containing the
effective address specified in <em>rs1</em>.
These instructions also specify a <em>level</em>, which is a hint to the hardware to
allocate the cache block in a designated cache.
<em>level</em> is specified as follows:</p>
</div>
<div id="__asciidoctor-preview-273__" class="ulist">
<ul>
<li id="__asciidoctor-preview-274__">
<p><code>default</code>&#8201;&#8212;&#8201;an <em>implementation-defined</em> level, which may be a function of
physical addresses, dynamic allocation policies, or any other characteristic</p>
</li>
<li id="__asciidoctor-preview-275__">
<p><code>L1</code>&#8201;&#8212;&#8201;the first cache logically accessed by a hart on the path to memory</p>
</li>
<li id="__asciidoctor-preview-276__">
<p><code>L2</code>&#8201;&#8212;&#8201;the second cache logically accessed by a hart on the path to memory</p>
</li>
<li id="__asciidoctor-preview-277__">
<p><code>L3</code>&#8201;&#8212;&#8201;the third cache logically accessed by a hart on the path to memory</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-278__" class="paragraph">
<p>An implementation may ignore <em>level</em> and assume <em>level</em> is <code>default</code> for all
cache block write instructions.</p>
</div>
<div id="__asciidoctor-preview-279__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-280__" class="paragraph">
<p><em>To a certain degree, level is implementation-defined for all systems; however,
<code>L1</code>, <code>L2</code>, and <code>L3</code> are intended to communicate their common, informal
meaning.</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cbo_zero">4.2.1. <code>CBO.ZERO</code></h4>
<div id="__asciidoctor-preview-281__" class="paragraph">
<p>A <code>CBO.ZERO</code> instruction performs a series of byte writes whose data value
equals zero to all the bytes in a cache block.
An implementation may write any number of bytes in the cache block atomically.
The instruction may allocate, but is <em>not</em> guaranteed to allocate, the cache
block in the cache specified by <em>level</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cache_block_hint_instructions">4.3. Cache Block Hint Instructions</h3>
<div id="__asciidoctor-preview-282__" class="paragraph">
<p>Cache block hint instructions operate on the cache blocks containing the
effective address specified in <em>rs1</em>.
These instructions also specify a <em>level</em>, which is a hint to the hardware to
allocate the cache block in a designated cache.
<em>level</em> is specified as follows:</p>
</div>
<div id="__asciidoctor-preview-283__" class="ulist">
<ul>
<li id="__asciidoctor-preview-284__">
<p><code>default</code>&#8201;&#8212;&#8201;an <em>implementation-defined</em> level, which may be a function of
physical addresses, dynamic allocation policies, or any other characteristic</p>
</li>
<li id="__asciidoctor-preview-285__">
<p><code>L1</code>&#8201;&#8212;&#8201;the first cache logically accessed by a hart on the path to memory</p>
</li>
<li id="__asciidoctor-preview-286__">
<p><code>L2</code>&#8201;&#8212;&#8201;the second cache logically accessed by a hart on the path to memory</p>
</li>
<li id="__asciidoctor-preview-287__">
<p><code>L3</code>&#8201;&#8212;&#8201;the third cache logically accessed by a hart on the path to memory</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-288__" class="paragraph">
<p>An implementation may ignore <em>level</em> and assume <em>level</em> is <code>default</code> for all
cache block hint instructions.</p>
</div>
<div id="__asciidoctor-preview-289__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-290__" class="paragraph">
<p><em>To a certain degree, level is implementation-defined for all systems; however,
<code>L1</code>, <code>L2</code>, and <code>L3</code> are intended to communicate their common, informal
meaning.</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prefetch_r">4.3.1. <code>PREFETCH.R</code></h4>
<div id="__asciidoctor-preview-291__" class="paragraph">
<p>A <code>PREFETCH.R</code> instruction indicates to the cache at the specified <em>level</em> that
a subsequent read operation is likely to be performed on the cache block at the
specified effective address in the near future.</p>
</div>
<div id="__asciidoctor-preview-292__" class="paragraph">
<p>An implementation typically allocates the cache block in the cache at the
specified <em>level</em> in a state that allows read access; however, the instruction
is <em>not</em> guaranteed to allocate the cache block in that cache.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prefetch_w">4.3.2. <code>PREFETCH.W</code></h4>
<div id="__asciidoctor-preview-293__" class="paragraph">
<p>A <code>PREFETCH.W</code> instruction indicates to the cache at the specified <em>level</em> that
a subsequent write operation is likely to be performed on the cache block at
the specified effective address in the near future.</p>
</div>
<div id="__asciidoctor-preview-294__" class="paragraph">
<p>An implementation typically allocates the cache block in the cache at the
specified <em>level</em> in a state that allows write access; however, the instruction
is <em>not</em> guaranteed to allocate the cache block in that cache.</p>
</div>
<div id="__asciidoctor-preview-295__" class="paragraph">
<p>A PREFETCH.W instruction may interfere with the eventual success guarantee of
store-conditional instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prefetch_i">4.3.3. <code>PREFETCH.I</code></h4>
<div id="__asciidoctor-preview-296__" class="paragraph">
<p>A <code>PREFETCH.I</code> instruction indicates to the cache at the specified <em>level</em> that
a subsequent instruction fetch operation is likely to be performed on the
cache block at the specified effective address in the near future.</p>
</div>
<div id="__asciidoctor-preview-297__" class="paragraph">
<p>An implementation typically allocates the cache block in the cache at the
specified <em>level</em> in a state that allows instruction fetch access; however, the
instruction is <em>not</em> guaranteed to allocate the cache block in that cache.</p>
</div>
<div id="__asciidoctor-preview-298__" class="paragraph">
<p>Instruction fetch operations may access caches different from those accessed by
read and write operations.
It is <em>implementation-defined</em> whether the cache at the specified <em>level</em> in a
<code>PREFETCH.I</code> instruction is the same cache at the specified <em>level</em> in a
<code>PREFETCH.R</code> or <code>PREFETCH.W</code> instruction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_demote">4.3.4. <code>DEMOTE</code></h4>
<div id="__asciidoctor-preview-299__" class="paragraph">
<p>A <code>DEMOTE</code> instruction indicates to the cache at the specified <em>level</em> that the
cache block at the specified effective address is no longer required to be
cached.</p>
</div>
<div id="__asciidoctor-preview-300__" class="sidebarblock">
<div class="content">
<div id="__asciidoctor-preview-301__" class="paragraph">
<p><em>Typically, a <code>DEMOTE</code> instruction operates on the replacement algorithm</em>
<em>information for a cache block rather than the cache block itself.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fixme_cache_block_discovery_instruction">4.4. FIXME: Cache Block Discovery Instruction</h3>
<div class="sect3">
<h4 id="_fixme_cbo_size">4.4.1. FIXME: <code>CBO.SIZE</code></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_opcode_map">5. Opcode Map</h2>
<div class="sectionbody">
<hr>
<div id="__asciidoctor-preview-303__" class="paragraph text-center">
<p><strong>FIXME BEYOND HERE</strong></p>
</div>
<hr>
<div id="__asciidoctor-preview-305__" class="sidebarblock">
<div class="content">
<div class="title">Ignore Me</div>
<div id="__asciidoctor-preview-306__" class="paragraph">
<p>PoC Wording:</p>
</div>
<div id="__asciidoctor-preview-307__" class="paragraph">
<p>Paths converge at a <em>point of convergence</em>, or <em>PoC</em>, which designates the
point at which a set of memory accesses to the same memory location is
logically ordered.
Once ordered by a PoC, a memory access in the set cannot be reordered with
respect to other memory accesses in the set, and the set of memory accesses
shares the remainder of the path to the memory location.</p>
</div>
<div id="__asciidoctor-preview-308__" class="paragraph">
<p>The fundamental PoC for a given physical
address is the <em>point of convergence for memory</em>, or <em>PoC-memory</em>, which is the
PoC where all paths for that physical address converge, independent of all
other characteristics that define a path.</p>
</div>
<div id="__asciidoctor-preview-309__" class="paragraph">
<p>Memory Ordering Wording:</p>
</div>
<div id="__asciidoctor-preview-310__" class="paragraph">
<p><em>The existing <code>FENCE</code> instruction is sufficient to order the cache management operations in the base extension.</em>
<em>In future extensions, an additional fence instruction may be required to determine when certain cache management operations are complete.</em></p>
</div>
<div id="__asciidoctor-preview-311__" class="paragraph">
<p>CSR stuff:</p>
</div>
<div id="__asciidoctor-preview-312__" class="paragraph">
<p>| [9:8]   | <code>INVW0</code>  | CBO.INVAL access without write permission (<code><em>Wx</em>=0</code>).</p>
</div>
<div id="__asciidoctor-preview-313__" class="paragraph">
<p>Determines the behavior of a CBO.INVAL instruction when the corresponding
access does <em>not</em> have write permission in the effective privilege mode:</p>
</div>
<div id="__asciidoctor-preview-314__" class="ulist">
<ul>
<li id="__asciidoctor-preview-315__">
<p><code>0</code>: Execution results in an exception (page fault, guest-page fault, or
access fault) [trap]</p>
</li>
<li id="__asciidoctor-preview-316__">
<p><code>1</code>: <em>Reserved</em> (aliases to <code>0</code>)</p>
</li>
<li id="__asciidoctor-preview-317__">
<p><code>2</code>: Execution performs a flush operation [flush]</p>
</li>
<li id="__asciidoctor-preview-318__">
<p><code>3</code>: Execution performs an invalidate operation [invalidate]</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-319__" class="paragraph">
<p>| [11:10] | <code>INVW1</code>  | CBO.INVAL access with write permission (<code><em>Wx</em>=1</code>).</p>
</div>
<div id="__asciidoctor-preview-320__" class="paragraph">
<p>Determines the behavior of a CBO.INVAL instruction when the corresponding
access has write permission in the effective privilege mode:</p>
</div>
<div id="__asciidoctor-preview-321__" class="ulist">
<ul>
<li id="__asciidoctor-preview-322__">
<p><code>0</code>: Execution results in an exception (page fault, guest-page fault, or
access fault depending on the CSR) [trap]</p>
</li>
<li id="__asciidoctor-preview-323__">
<p><code>1</code>: <em>Reserved</em> (aliases to <code>0</code>)</p>
</li>
<li id="__asciidoctor-preview-324__">
<p><code>2</code>: Execution performs a flush operation [flush]</p>
</li>
<li id="__asciidoctor-preview-325__">
<p><code>3</code>: Execution performs an invalidate operation [invalidate]</p>
</li>
</ul>
</div>
<div id="__asciidoctor-preview-326__" class="paragraph">
<p>|         |          |</p>
</div>
</div>
</div>
</div>
</div>
        </div>
      </div>
    </body>
  </html>
